(function(){"use strict";var scripts=document.getElementsByTagName("script");var currentScriptPath=scripts[scripts.length-1].src;angular.module("acUtils",["ngRoute"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/module",{templateUrl:currentScriptPath.replace(".js",".html"),controller:"AcUtils"})}]).controller("AcUtilsController",AcUtilsController).factory("AcUtils",AcUtils).service("AcUtilsGlobals",AcUtilsGlobals).directive("acSearchPanel",AcSearchPanel).directive("acValidator",AcValidator);AcValidator.$inject=["AcUtils","AcUtilsGlobals"];function AcValidator(AcUtils,AcUtilsGlobals){return{restrict:"A",scope:{isRequired:"@",minLength:"@",maxLength:"@",isMail:"@",minNumber:"@",maxNumber:"@",minDate:"@",maxDate:"@"},controller:function($scope,$element,$attrs){var vm=this;AcUtilsGlobals.listen(function(){var control=angular.element(document.querySelectorAll(".error-input"));var error=angular.element(document.querySelectorAll(".error-message"));for(var i=0;i<control.length;i++){control[i].classList.remove("error-input");control[i].removeEventListener("focus")}for(var i=0;i<error.length;i++){error[i].remove()}});function getMainContainer(el){while(el.parent()){el=el.parent();for(var i=0;i<el[0].attributes.length;i++){if(el[0].attributes[i].nodeName=="form-id"){return el[0].attributes[i].nodeValue}}}return null}function addError(parent){var index=-1;var sub_index=-1;for(var i=0;i<AcUtilsGlobals.errores.length;i++){if(AcUtilsGlobals.errores[i].parent==parent){index=i;for(var x=0;x<AcUtilsGlobals.errores[i].errores.length;x++){if(AcUtilsGlobals.errores[i].errores[x].control==$element[0].id){sub_index=x}}}}if(index==-1){AcUtilsGlobals.errores.push({parent:parent,errores:[{control:$element[0].id}]})}else{if(sub_index==-1){AcUtilsGlobals.errores[index].errores.push({control:$element[0].id})}}console.log(AcUtilsGlobals.errores)}function removeError(parent){var index=-1;var sub_index=-1;for(var i=0;i<AcUtilsGlobals.errores.length;i++){if(AcUtilsGlobals.errores[i].parent==parent){index=i;for(var x=0;x<AcUtilsGlobals.errores[i].errores.length;x++){if(AcUtilsGlobals.errores[i].errores[x].control==$element[0].id){sub_index=x}}}}if(index!=-1&&sub_index!=-1){AcUtilsGlobals.errores[index].errores.splice(sub_index,1)}}$element.bind("click",function(e){if($element[0].tagName=="BUTTON"||$element[0].type=="button"){var parent=getMainContainer($element);for(var i=0;i<AcUtilsGlobals.errores.length;i++){if(AcUtilsGlobals.errores[i].parent==parent&&AcUtilsGlobals.errores[i].errores.length>0){e.stopImmediatePropagation();e.preventDefault();e.stopPropagation()}}}});$element.bind("blur",function(){if($element[0].tagName=="BUTTON"||$element[0].type=="button"){return}var id=Math.floor(Math.random()*1e3+1);var elem=$element;var texto="";if($scope.isRequired!=undefined&&$element.val().trim().length==0){texto=texto+$scope.isRequired+"</br>"}if($scope.minLength!=undefined&&$element.val().length<$scope.minLength.split(";")[0]){texto=texto+$scope.minLength.split(";")[1]+"</br>"}if($scope.maxLength!=undefined&&$element.val().length>$scope.maxLength.split(";")[0]){texto=texto+$scope.maxLength.split(";")[1]+"</br>"}if($scope.isMail!=undefined&&!AcUtils.validateEmail($element.val())){texto=texto+$scope.isMail+"</br>"}if($scope.minNumber!=undefined&&parseFloat($element.val())<parseFloat($scope.minNumber.split(";")[0])){texto=texto+$scope.minNumber.split(";")[1]+"</br>"}if($scope.maxNumber!=undefined&&parseFloat($element.val())<parseFloat($scope.maxLength.split(";")[0])){texto=texto+$scope.maxNumber.split(";")[1]+"</br>"}if($scope.minDate!=undefined){if($scope.minDate.split(";")[0]=="today"){if(new Date($element.val())<new Date){texto=texto+$scope.minDate.split(";")[1]+"</br>"}}else{if(new Date($element.val())<new Date($scope.minDate.split(";")[0])){texto=texto+$scope.minDate.split(";")[1]+"</br>"}}}if($scope.maxDate!=undefined){if($scope.maxDate.split(";")[0]=="today"){if(new Date($element.val())>new Date){texto=texto+$scope.maxDate.split(";")[1]+"</br>"}}else{if(new Date($element.val())>new Date($scope.minDate.split(";")[0])){texto=texto+$scope.maxDate.split(";")[1]+"</br>"}}}texto=texto.substr(0,texto.length-5);if(texto.trim().length==0){removeError(getMainContainer(elem));return}else{addError(getMainContainer(elem))}elem.addClass("error-input");elem.after('<div class="error-message" id="error-'+id+'">'+texto+"</div>");var mensaje=angular.element(document.querySelector("#error-"+id));mensaje.css("top",elem[0].offsetTop+elem[0].offsetHeight+"px");mensaje.css("left",elem[0].offsetLeft+"px");clear();function clear(){elem[0].addEventListener("focus",function(){elem.removeClass("error-input");elem[0].removeEventListener("focus");mensaje.remove();removeError(getMainContainer(elem))})}})},link:function(scope,element,attr){},controllerAs:"acSearchCtrl"}}AcSearchPanel.$inject=["$injector","AcUtilsGlobals","$timeout","$compile"];function AcSearchPanel($injector,AcUtilsGlobals,$timeout,$compile){return{restrict:"AE",scope:{service:"=",params:"@",exactMatch:"=",visible:"@",selected:"=",objeto:"=",func:"@",minInput:"="},controller:function($scope,$element,$attrs){var vm=this;vm.resultados=[];vm.acItemListPanelSelected=0;var timeout={};vm.minInput=$scope.minInput?$scope.minInput:2;vm.over=false;$element.bind("mouseleave",function(){vm.over=false;timeout=$timeout(AcUtilsGlobals.broadcastPanel,1e3)});$element.bind("mouseover",function(){$timeout.cancel(timeout);vm.over=true});vm.selectItem=function(i){$scope.objeto=angular.copy(vm.resultados[i]);vm.over=false;AcUtilsGlobals.broadcastPanel()};$element.bind("keyup focus",function(event){$timeout.cancel(timeout);if($element.val().length>vm.minInput){vm.over=false;AcUtilsGlobals.broadcastPanel();var myService=$injector.get($attrs.service);if($scope.func!=undefined){$injector.get($attrs.service)[$scope.func]($scope.params,$element.val(),function(data){if(data.length>0){procesarRespuesta(data)}})}else{myService.getByParams($attrs.params,$element.val(),$attrs.exactMatch,function(data){if(data.length>0){procesarRespuesta(data)}})}}else{vm.over=false;AcUtilsGlobals.broadcastPanel()}});function procesarRespuesta(data){vm.resultados=data;var id=Math.floor(Math.random()*1e5+1);$element.after('<div class="ac-result-panel" id="panel-'+id+'"></div>');var lista=angular.element(document.querySelector("#panel-"+id));lista.bind("mouseleave",function(){vm.over=false;timeout=$timeout(AcUtilsGlobals.broadcastPanel,1e3)});lista.bind("mouseover focus",function(){$timeout.cancel(timeout);vm.over=true});var a_mostrar_columnas=$attrs.visible.split(",");for(var i=0;i<data.length;i++){var columns=Object.keys(data[i]);var a_mostrar_text="";for(var x=0;x<columns.length;x++){for(var y=0;y<a_mostrar_columnas.length;y++){if(a_mostrar_columnas[y]==columns[x]){var base=" "+data[i][Object.keys(data[i])[x]];a_mostrar_text=a_mostrar_text+base}}}lista.append($compile('<div class="ac-item-list" ng-click="acSearchCtrl.selectItem('+i+")\" ng-class=\"{'ac-item-selected-list': acSearchCtrl.acItemListPanelSelected == "+i+'}">'+a_mostrar_text+"</div>")($scope))}if(event.keyCode==40){vm.acItemListPanelSelected=vm.acItemListPanelSelected+1>data.length-1?vm.acItemListPanelSelected:vm.acItemListPanelSelected+1}if(event.keyCode==38){vm.acItemListPanelSelected=vm.acItemListPanelSelected-1<0?vm.acItemListPanelSelected:vm.acItemListPanelSelected-1}if(event.keyCode==13){vm.selectItem(vm.acItemListPanelSelected)}lista.css("position","absolute");lista.css("top",$element[0].offsetTop+$element[0].offsetHeight+"px");lista.css("left",$element[0].offsetLeft+"px");lista.css("width",$element[0].offsetWidth+"px");lista.css("max-width",$element[0].offsetWidth+"px");vm.over=true}AcUtilsGlobals.listenPanel(function(){if(vm.over){return}var control=angular.element(document.querySelectorAll(".ac-result-panel"));for(var i=0;i<control.length;i++){control[i].remove()}})},link:function(scope,element,attr){},controllerAs:"acSearchCtrl"}}AcUtilsController.$inject=[];function AcUtilsController(){}AcUtilsGlobals.$inject=["$rootScope"];function AcUtilsGlobals($rootScope){this.isWaiting=false;this.sucursal_auxiliar_id=-1;this.getByParamsLenght=2;this.errores=[];this.broadcast=function(){$rootScope.$broadcast("AcUtilsGlobalsValidations")};this.listen=function(callback){$rootScope.$on("AcUtilsGlobalsValidations",callback)};this.broadcastPanel=function(){$rootScope.$broadcast("acSearchPanels")};this.listenPanel=function(callback){$rootScope.$on("acSearchPanels",callback)}}AcUtils.$inject=["AcUtilsGlobals"];function AcUtils(AcUtilsGlobals){var service={};service.validateEmail=validateEmail;service.validations=validations;service.verifyBrowser=verifyBrowser;service.getByParams=getByParams;return service;function getByParams(params,values,exact_match,data,callback){if(data.length==0){return}var parametros=params.split(",");var valores=values.split(",");var exactos=exact_match.split(",");var respuesta=[];for(var y=0;y<data.length;y++){var columns=Object.keys(data[y]);for(var i=0;i<columns.length;i++){for(var x=0;x<parametros.length;x++){if(columns[i]==parametros[x]){var base=""+data[y][Object.keys(data[y])[i]];var valor=valores.length==1?""+valores[0]:""+valores[x];var exacto=exactos.length==1?exactos[0]:exactos[x];exacto=exacto=="true";var negado=valor.indexOf("!")>-1;var index_a_sacar=[];if(negado){if(exacto&&base.toUpperCase()!==valor.toUpperCase().replace("!","")||!exacto&&base.toUpperCase().indexOf(valor.toUpperCase().replace("!",""))==-1){respuesta.push(data[y]);x=parametros.length;i=columns.length}else{index_a_sacar.push(y)}}else{if(exacto&&base.toUpperCase()==valor.toUpperCase()||!exacto&&base.toUpperCase().indexOf(valor.toUpperCase())>-1){respuesta.push(data[y]);x=parametros.length;i=columns.length}}}}}}callback(respuesta)}function verifyBrowser(){var obj={};obj.isOpera=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;obj.isFirefox=typeof InstallTrigger!=="undefined";obj.isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0;obj.isChrome=!!window.chrome&&!isOpera;obj.isIE=false||!!document.documentMode;return obj}function validateEmail(email){var re=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return re.test(email)}function validations(control,texto){var id=Math.floor(Math.random()*1e3+1);var elem=angular.element(document.querySelector("#"+control));elem.addClass("error-input");elem.after('<div class="error-message" id="error-'+id+'">'+texto+"</div>");var mensaje=angular.element(document.querySelector("#error-"+id));mensaje.css("top",elem[0].offsetTop+elem[0].offsetHeight+"px");mensaje.css("left",elem[0].offsetLeft+"px");clear();function clear(){elem[0].addEventListener("focus",function(){elem.removeClass("error-input");elem[0].removeEventListener("focus");mensaje.remove()})}AcUtilsGlobals.listen(function(){var control=angular.element(document.querySelectorAll(".error-input"));var error=angular.element(document.querySelectorAll(".error-message"));for(var i=0;i<control.length;i++){control[i].classList.remove("error-input");control[i].removeEventListener("focus");mensaje.remove()}for(var i=0;i<error.length;i++){error[i].remove()}})}}})();var dateFormat=function(){var token=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,timezone=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,timezoneClip=/[^-+\dA-Z]/g,pad=function(val,len){val=String(val);len=len||2;while(val.length<len)val="0"+val;return val};return function(date,mask,utc){var dF=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(date)=="[object String]"&&!/\d/.test(date)){mask=date;date=undefined}date=date?new Date(date):new Date;if(isNaN(date)&&!(typeof InstallTrigger!=="undefined"))throw SyntaxError("invalid date");mask=String(dF.masks[mask]||mask||dF.masks["default"]);if(mask.slice(0,4)=="UTC:"){mask=mask.slice(4);utc=true}var _=utc?"getUTC":"get",d=date[_+"Date"](),D=date[_+"Day"](),m=date[_+"Month"](),y=date[_+"FullYear"](),H=date[_+"Hours"](),M=date[_+"Minutes"](),s=date[_+"Seconds"](),L=date[_+"Milliseconds"](),o=utc?0:date.getTimezoneOffset(),flags={d:d,dd:pad(d),ddd:dF.i18n.dayNames[D],dddd:dF.i18n.dayNames[D+7],m:m+1,mm:pad(m+1),mmm:dF.i18n.monthNames[m],mmmm:dF.i18n.monthNames[m+12],yy:String(y).slice(2),yyyy:y,h:H%12||12,hh:pad(H%12||12),H:H,HH:pad(H),M:M,MM:pad(M),s:s,ss:pad(s),l:pad(L,3),L:pad(L>99?Math.round(L/10):L),t:H<12?"a":"p",tt:H<12?"am":"pm",T:H<12?"A":"P",TT:H<12?"AM":"PM",Z:utc?"UTC":(String(date).match(timezone)||[""]).pop().replace(timezoneClip,""),o:(o>0?"-":"+")+pad(Math.floor(Math.abs(o)/60)*100+Math.abs(o)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10]};return mask.replace(token,function($0){return $0 in flags?flags[$0]:$0.slice(1,$0.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format=function(mask,utc){return dateFormat(this,mask,utc)};